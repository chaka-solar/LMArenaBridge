# PostgreSQL æ‰«æå·¥å…·é›† - æ–‡ä»¶ç´¢å¼•

## ğŸ“š æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶å | æè¿° | ä½¿ç”¨å¯¹è±¡ |
|--------|------|----------|
| `README.md` | å®Œæ•´ä½¿ç”¨æ–‡æ¡£å’ŒæŠ€æœ¯è¯´æ˜ | æ‰€æœ‰ç”¨æˆ· |
| `QUICKSTART.md` | å¿«é€Ÿå¼€å§‹æŒ‡å— | æ–°ç”¨æˆ· |
| `INDEX.md` | æœ¬æ–‡ä»¶ï¼Œæ–‡ä»¶ç´¢å¼• | æ‰€æœ‰ç”¨æˆ· |

## ğŸ”§ æ ¸å¿ƒå·¥å…·

### Python å·¥å…·ï¼ˆæ¨èï¼‰

| æ–‡ä»¶å | æè¿° | ä¾èµ– |
|--------|------|------|
| `generate_scan_batches.py` | æ‰¹æ¬¡è„šæœ¬ç”Ÿæˆå™¨ | Python 3.6+, psycopg2 |

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
python generate_scan_batches.py --database mydb --user postgres
```

### SQL å·¥å…·

| æ–‡ä»¶å | æè¿° | ä¾èµ– |
|--------|------|------|
| `quick_scan_single_batch.sql` | å¿«é€Ÿå•æ‰¹æ¬¡æ‰«æï¼ˆå‰ 100 è¡¨ï¼‰ | PostgreSQL 9.6+ |
| `generate_batch_scripts.sql` | SQL æ–¹å¼ç”Ÿæˆæ‰¹æ¬¡ä¿¡æ¯ | PostgreSQL 9.6+ |
| `batch_template.sql` | æ‰¹æ¬¡è„šæœ¬æ¨¡æ¿ | - |

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
# å¿«é€Ÿæ‰«æ
psql -U postgres -d mydb -f quick_scan_single_batch.sql

# æŸ¥çœ‹æ‰¹æ¬¡ä¿¡æ¯
psql -U postgres -d mydb -f generate_batch_scripts.sql
```

### Shell è„šæœ¬

| æ–‡ä»¶å | æè¿° | å¹³å° |
|--------|------|------|
| `run_all_batches.sh` | æ‰¹é‡æ‰§è¡Œå™¨ï¼ˆLinux/macOSï¼‰ | Bash 4.0+ |
| `run_all_batches.bat` | æ‰¹é‡æ‰§è¡Œå™¨ï¼ˆWindowsï¼‰ | Windows 7+ |

**ä½¿ç”¨æ–¹å¼**ï¼š
```bash
# Linux/macOS
./run_all_batches.sh -d mydb -u postgres

# Windows
run_all_batches.bat -d mydb -u postgres
```

## ğŸ“„ é…ç½®å’Œç¤ºä¾‹

| æ–‡ä»¶å | æè¿° | ç”¨é€” |
|--------|------|------|
| `config.example.env` | é…ç½®æ–‡ä»¶ç¤ºä¾‹ | ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿ |
| `example_batch_001_001_100.sql` | ç¤ºä¾‹æ‰¹æ¬¡è„šæœ¬ | ç†è§£è„šæœ¬ç»“æ„ |
| `.gitignore` | Git å¿½ç•¥è§„åˆ™ | ç‰ˆæœ¬æ§åˆ¶ |

## ğŸš€ å¿«é€Ÿä½¿ç”¨æµç¨‹å›¾

```
å¼€å§‹
  â”‚
  â”œâ”€â†’ å°æ•°æ®åº“ï¼ˆ< 100 è¡¨ï¼‰ï¼Ÿ
  â”‚   â””â”€â†’ æ˜¯ï¼šä½¿ç”¨ quick_scan_single_batch.sql âœ“
  â”‚
  â””â”€â†’ å¤§æ•°æ®åº“ï¼ˆâ‰¥ 100 è¡¨ï¼‰ï¼Ÿ
      â””â”€â†’ æ˜¯ï¼š
          â”œâ”€â†’ 1. å®‰è£… Python ä¾èµ–ï¼ˆpsycopg2ï¼‰
          â”œâ”€â†’ 2. è¿è¡Œ generate_scan_batches.py
          â”œâ”€â†’ 3. æ‰§è¡Œ run_all_batches.sh
          â””â”€â†’ 4. æŸ¥çœ‹ results/ ç›®å½•
```

## ğŸ“‚ ç›®å½•ç»“æ„

ç”Ÿæˆå’Œæ‰§è¡Œåçš„å®Œæ•´ç›®å½•ç»“æ„ï¼š

```
postgres_scan_scripts/
â”œâ”€â”€ ğŸ“„ æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                      # å®Œæ•´æ–‡æ¡£
â”‚   â”œâ”€â”€ QUICKSTART.md                  # å¿«é€ŸæŒ‡å—
â”‚   â””â”€â”€ INDEX.md                       # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ Python å·¥å…·
â”‚   â””â”€â”€ generate_scan_batches.py       # è„šæœ¬ç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ ğŸ—„ï¸ SQL è„šæœ¬
â”‚   â”œâ”€â”€ quick_scan_single_batch.sql    # å¿«é€Ÿæ‰«æ
â”‚   â”œâ”€â”€ generate_batch_scripts.sql     # æ‰¹æ¬¡ä¿¡æ¯ç”Ÿæˆ
â”‚   â”œâ”€â”€ batch_template.sql             # æ¨¡æ¿
â”‚   â””â”€â”€ example_batch_001_001_100.sql  # ç¤ºä¾‹
â”‚
â”œâ”€â”€ ğŸ–¥ï¸ Shell è„šæœ¬
â”‚   â”œâ”€â”€ run_all_batches.sh             # Unix æ‰§è¡Œå™¨
â”‚   â””â”€â”€ run_all_batches.bat            # Windows æ‰§è¡Œå™¨
â”‚
â”œâ”€â”€ âš™ï¸ é…ç½®
â”‚   â”œâ”€â”€ config.example.env             # é…ç½®ç¤ºä¾‹
â”‚   â””â”€â”€ .gitignore                     # Git å¿½ç•¥
â”‚
â”œâ”€â”€ ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆæ‰§è¡Œåï¼‰
â”‚   â”œâ”€â”€ batches/                       # ç”Ÿæˆçš„æ‰¹æ¬¡è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ batch_001_0001_0100.sql
â”‚   â”‚   â”œâ”€â”€ batch_002_0101_0200.sql
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ results/                       # æ‰§è¡Œç»“æœ
â”‚       â”œâ”€â”€ batch_001_output.txt
â”‚       â”œâ”€â”€ batch_002_output.txt
â”‚       â”œâ”€â”€ summary_all_batches.txt
â”‚       â””â”€â”€ ...
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯å¯¹ç…§è¡¨

| åœºæ™¯ | æ¨èå·¥å…· | å‘½ä»¤ç¤ºä¾‹ |
|------|----------|----------|
| å¿«é€Ÿæµ‹è¯• | `quick_scan_single_batch.sql` | `psql -f quick_scan_single_batch.sql` |
| å°å‹æ•°æ®åº“ï¼ˆ< 100 è¡¨ï¼‰ | `quick_scan_single_batch.sql` | åŒä¸Š |
| ä¸­å‹æ•°æ®åº“ï¼ˆ100-500 è¡¨ï¼‰ | `generate_scan_batches.py` + `run_all_batches.sh` | è§ä¸‹æ–¹ |
| å¤§å‹æ•°æ®åº“ï¼ˆ> 500 è¡¨ï¼‰ | åŒä¸Šï¼Œè°ƒå°æ‰¹æ¬¡å¤§å° | `--batch-size 50` |
| ç”Ÿäº§ç¯å¢ƒ | åŒä¸Šï¼Œä½¿ç”¨åªè¯»è´¦æˆ· | `--user readonly_user` |
| Windows ç¯å¢ƒ | `generate_scan_batches.py` + `run_all_batches.bat` | è§æ–‡æ¡£ |
| æ—  Python ç¯å¢ƒ | `quick_scan_single_batch.sql` + æ‰‹åŠ¨æ‰¹æ¬¡ | æ‰‹åŠ¨æ‰§è¡Œ |

### ä¸­å¤§å‹æ•°æ®åº“å®Œæ•´å‘½ä»¤

```bash
# 1. ç”Ÿæˆæ‰¹æ¬¡è„šæœ¬
python generate_scan_batches.py \
    --host localhost \
    --database mydb \
    --user postgres \
    --output-dir ./batches

# 2. æ‰¹é‡æ‰§è¡Œ
./run_all_batches.sh \
    -h localhost \
    -d mydb \
    -u postgres \
    -o ./results
```

## ğŸ”— æ–‡ä»¶é—´ä¾èµ–å…³ç³»

```
generate_scan_batches.py
  â”‚
  â”œâ”€â†’ è¯»å–ï¼šbatch_template.sqlï¼ˆå¯é€‰ï¼‰
  â”‚
  â””â”€â†’ ç”Ÿæˆï¼šbatches/batch_*.sql
      â”‚
      â””â”€â†’ è¢«æ‰§è¡Œï¼šrun_all_batches.sh
          â”‚
          â””â”€â†’ ç”Ÿæˆï¼šresults/*_output.txt
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

### æ‰¹æ¬¡è„šæœ¬è¾“å‡ºï¼ˆ`*_output.txt`ï¼‰

åŒ…å«å†…å®¹ï¼š
- æ‰«æè¿›åº¦ä¿¡æ¯
- æ‰¾åˆ°åŒ¹é…çš„è¯¦ç»†è®°å½•
- æ‰¹æ¬¡ç»Ÿè®¡ä¿¡æ¯
- æ‰§è¡Œæ—¶é—´

### æ±‡æ€»æ–‡ä»¶ï¼ˆ`summary_all_batches.txt`ï¼‰

åŒ…å«å†…å®¹ï¼š
- æ‰€æœ‰æ‰¹æ¬¡çš„åŒ¹é…ç»“æœæ‘˜è¦
- æŒ‰æ‰¹æ¬¡ç»„ç»‡
- å¿«é€ŸæŸ¥æ‰¾æ‰€æœ‰åŒ¹é…ä½ç½®

## ğŸ› ï¸ è‡ªå®šä¹‰å’Œæ‰©å±•

### ä¿®æ”¹æœç´¢å€¼

ç¼–è¾‘æ–‡ä»¶ï¼š`generate_scan_batches.py`
ä½ç½®ï¼šç¬¬ 57 è¡Œ
```python
search_values = ["è¨‚å–®", "å‡ºè²¨å–®", "ä½ çš„æ–°å€¼"]
```

### ä¿®æ”¹æ‰¹æ¬¡å¤§å°

å‘½ä»¤è¡Œå‚æ•°ï¼š
```bash
python generate_scan_batches.py --batch-size 50
```

### æ·»åŠ è¡¨è¿‡æ»¤æ¡ä»¶

ç¼–è¾‘æ–‡ä»¶ï¼š`generate_scan_batches.py`
ä½ç½®ï¼š`get_tables()` å‡½æ•°ä¸­çš„ SQL æŸ¥è¯¢

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç ä¿æŠ¤**ï¼šä¸è¦æäº¤ `config.env` åˆ°ç‰ˆæœ¬æ§åˆ¶
2. **æƒé™æ§åˆ¶**ï¼šç”Ÿäº§ç¯å¢ƒä½¿ç”¨åªè¯»è´¦æˆ·
3. **å¤‡ä»½æ•°æ®**ï¼šæ‰§è¡Œå‰ç¡®ä¿æœ‰æ•°æ®åº“å¤‡ä»½
4. **æµ‹è¯•å…ˆè¡Œ**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

## ğŸ“ æ”¯æŒä¿¡æ¯

- **å®Œæ•´æ–‡æ¡£**ï¼šæŸ¥çœ‹ `README.md`
- **å¿«é€Ÿå…¥é—¨**ï¼šæŸ¥çœ‹ `QUICKSTART.md`
- **ç¤ºä¾‹ä»£ç **ï¼šæŸ¥çœ‹ `example_batch_001_001_100.sql`

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**ï¼š1.0.0
- **æ›´æ–°æ—¥æœŸ**ï¼š2024-01-08
- **å…¼å®¹æ€§**ï¼šPostgreSQL 9.6+

---

**æç¤º**ï¼šé¦–æ¬¡ä½¿ç”¨å»ºè®®ä» `QUICKSTART.md` å¼€å§‹é˜…è¯»ã€‚
